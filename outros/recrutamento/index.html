<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Formulário de Candidatura - FAM</title>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
<section class="form-section">
  <div class="container">
    <div class="form-header">
      <h2 class="section-title">Formulário de Candidatura</h2>
      <p class="section-subtitle">Escolha o tipo de vaga e preencha os dados necessários</p>
    </div>

    <form id="candidaturaForm" class="contact-form">
      <div class="form-group">
        <label for="tipoVaga">Tipo de Vaga:</label>
        <select name="tipoVaga" id="tipoVaga" required>
          <option value="">Selecione o tipo de vaga...</option>
          <option value="administrativo">Administrativo</option>
          <option value="docente">Docente</option>
        </select>
      </div>

      <!-- Campos Comuns -->
      <div id="camposComuns" style="display:none;">
        <div class="form-group">
          <label for="nomeCompleto">Nome Completo:</label>
          <input type="text" name="nomeCompleto" id="nomeCompleto" placeholder="Digite seu nome completo" required>
        </div>
        <div class="form-group">
          <label for="cpf">CPF:</label>
          <input type="text" name="cpf" id="cpf" placeholder="000.000.000-00" required>
        </div>
        <div class="form-group">
          <label for="telefoneCandidatura">Telefone:</label>
          <input type="tel" name="telefone" id="telefoneCandidatura" placeholder="(00) 00000-0000" required>
          <small class="form-text">Formato: (xx) xxxxx-xxxx</small>
        </div>
        <div class="form-group">
          <label for="email">E-mail:</label>
          <input type="email" name="email" id="email" placeholder="seu@email.com" required>
        </div>
        <div class="form-group">
          <label for="endereco">Endereço:</label>
          <input type="text" name="endereco" id="endereco" placeholder="Rua, número, bairro, cidade - UF" required>
        </div>
      </div>

      <!-- Campos Administrativo -->
      <div id="camposAdministrativo" style="display:none;">
        <div class="form-group">
          <label>Áreas de Interesse:</label>
          <div class="theme-checkboxes">
            <div class="checkbox-item">
              <input type="checkbox" name="areaInteresseAdmin" id="biblioteca" value="Biblioteca" class="area-checkbox">
              <label for="biblioteca">Biblioteca</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" name="areaInteresseAdmin" id="recepcao" value="Recepção" class="area-checkbox">
              <label for="recepcao">Recepção</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" name="areaInteresseAdmin" id="secretaria" value="Secretaria" class="area-checkbox">
              <label for="secretaria">Secretaria</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" name="areaInteresseAdmin" id="financeiro" value="Financeiro" class="area-checkbox">
              <label for="financeiro">Financeiro</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" name="areaInteresseAdmin" id="rh" value="RH" class="area-checkbox">
              <label for="rh">Recursos Humanos</label>
            </div>
             <div class="checkbox-item">
              <input type="checkbox" name="areaInteresseAdmin" id="ti" value="TI" class="area-checkbox">
              <label for="ti">Tecnologia da Informação</label>
            </div>
          </div>
          <p class="areas-selected">0 áreas selecionadas</p>
        </div>
        <div class="form-group">
          <label for="arquivoAdmin">Currículo (PDF/DOC/DOCX):</label>
          <input type="file" name="arquivo" id="arquivoAdmin" accept=".pdf,.doc,.docx">
          <small class="form-text">Opcional para vagas administrativas</small>
        </div>
        <div class="form-group">
          <label for="observacoesAdmin">Observações:</label>
           <textarea name="observacoesAdmin" id="observacoesAdmin" rows="4" placeholder="Conte-nos mais sobre sua experiência e motivação para esta vaga..."></textarea>
        </div>
      </div>

      <!-- Campos Docente -->
      <div id="camposDocente" style="display:none;">
        <div class="form-group">
          <label>Áreas de Interesse:</label>
          <div class="theme-checkboxes">
            <div class="checkbox-item">
              <input type="checkbox" name="areaInteresseDocente" id="medveterinaria" value="Medicina Veterinária" class="area-checkbox">
              <label for="medveterinaria">Medicina Veterinária</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" name="areaInteresseDocente" id="engenharia" value="Engenharia" class="area-checkbox">
              <label for="engenharia">Engenharia</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" name="areaInteresseDocente" id="tecnologia" value="Tecnologia" class="area-checkbox">
              <label for="tecnologia">Tecnologia</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" name="areaInteresseDocente" id="psicologia" value="Psicologia" class="area-checkbox">
              <label for="psicologia">Psicologia</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" name="areaInteresseDocente" id="administracao" value="Administração" class="area-checkbox">
              <label for="administracao">Administração</label>
            </div>
             <div class="checkbox-item">
              <input type="checkbox" name="areaInteresseDocente" id="educacao" value="Educação" class="area-checkbox">
              <label for="educacao">Educação</label>
            </div>
          </div>
          <p class="areas-selected">0 áreas selecionadas</p>
        </div>
        <div class="form-group">
          <label for="linkLattes">Link do Currículo Lattes:</label>
          <input type="url" name="linkLattes" id="linkLattes" placeholder="http://lattes.cnpq.br/...">
        </div>
        <div class="form-group">
          <label for="arquivoDocente">Currículo (PDF/DOC/DOCX) *:</label>
          <input type="file" name="arquivo" id="arquivoDocente" accept=".pdf,.doc,.docx">
          <small class="form-text">Obrigatório para vagas docentes</small>
        </div>
        <div class="form-group">
          <label for="observacoesDocente">Observações:</label>
           <textarea name="observacoesDocente" id="observacoesDocente" rows="4" placeholder="Conte-nos sobre sua experiência acadêmica, áreas de pesquisa e motivação..."></textarea>
        </div>
      </div>

      <button type="submit" class="submit-button">
        Enviar Candidatura
      </button>
    </form>
  </div>
</section>

<!-- Modal de Sucesso -->
<div id="successModalCandidatura" class="modal">
  <div class="modal-content">
    <span class="close-modal">&times;</span>
    <div class="success-message">
      <h3>Candidatura Enviada!</h3>
      <p>Agradecemos seu interesse. Entraremos em contato em breve.</p>
    </div>
  </div>
</div>


<script>
    // --- SCRIPT.JS - FORMULÁRIO DE CANDIDATURA ---

// --- CONFIGURAÇÃO ---
// Substitua pela URL real do seu Web App do Google Apps Script
const SCRIPT_URL_CANDIDATURA = 'https://script.google.com/macros/s/AKfycbweYRuLtrQXx9Y31GZOoqpf5GdLJf8VDwly85D4Ek7-RUhBDQV6PP8CnvJCwRQAZdGXgQ/exec';

// --- LÓGICA DE INTERFACE E ENVIO ---

document.addEventListener('DOMContentLoaded', function () {

    // --- Elementos do Formulário de Candidatura ---
    const formCandidatura = document.getElementById('candidaturaForm');
    const tipoVagaSelect = document.getElementById('tipoVaga');
    const camposComuns = document.getElementById('camposComuns');
    const camposAdmin = document.getElementById('camposAdministrativo');
    const camposDocente = document.getElementById('camposDocente');
    const modalCandidatura = document.getElementById('successModalCandidatura');
    const telefoneInputCandidatura = document.getElementById('telefoneCandidatura');

    // --- Funções Auxiliares ---

    /**
     * Aplica máscara de CPF (xxx.xxx.xxx-xx)
     * @param {HTMLInputElement} input - O campo de input do CPF
     */
    function aplicarMascaraCPF(input) {
        if (!input) return;

        input.addEventListener('input', function () {
            let value = this.value.replace(/\D/g, '');
            if (value.length > 11) value = value.substring(0, 11);
            let formattedValue = '';
            if (value.length <= 3) {
                formattedValue = value;
            } else if (value.length <= 6) {
                formattedValue = `${value.substring(0, 3)}.${value.substring(3)}`;
            } else if (value.length <= 9) {
                formattedValue = `${value.substring(0, 3)}.${value.substring(3, 6)}.${value.substring(6)}`;
            } else {
                formattedValue = `${value.substring(0, 3)}.${value.substring(3, 6)}.${value.substring(6, 9)}-${value.substring(9)}`;
            }
            this.value = formattedValue;
        });

        input.addEventListener('blur', function () {
            const regex = /^[0-9]{3}\.[0-9]{3}\.[0-9]{3}-[0-9]{2}$/;
            if (this.value && !regex.test(this.value)) {
                this.setCustomValidity('Por favor, digite um CPF completo no formato xxx.xxx.xxx-xx');
            } else {
                this.setCustomValidity('');
            }
        });
    }

    /**
     * Aplica máscara de telefone (xx) xxxxx-xxxx
     * @param {HTMLInputElement} input - O campo de input do telefone
     */
    function aplicarMascaraTelefone(input) {
        if (!input) return;

        input.addEventListener('input', function () {
            let value = this.value.replace(/\D/g, '');
            if (value.length > 11) value = value.substring(0, 11);
            let formattedValue = '';
            if (value.length <= 2) {
                formattedValue = value;
            } else if (value.length <= 7) {
                formattedValue = `(${value.substring(0, 2)}) ${value.substring(2)}`;
            } else {
                formattedValue = `(${value.substring(0, 2)}) ${value.substring(2, 7)}-${value.substring(7)}`;
            }
            this.value = formattedValue;
        });

        input.addEventListener('blur', function () {
            const regex = /^\([0-9]{2}\) [0-9]{5}-[0-9]{4}$/;
            if (this.value && !regex.test(this.value)) {
                this.setCustomValidity('Por favor, digite um telefone completo no formato (xx) xxxxx-xxxx');
            } else {
                this.setCustomValidity('');
            }
        });
    }

    /**
     * Configura o limite de seleção de áreas de interesse
     * @param {string} sectionId - ID da seção que contém os checkboxes
     * @param {number} maxSelecoes - Número máximo de seleções permitidas
     */
    function setupAreaSelection(sectionId, maxSelecoes = 5) {
        const section = document.getElementById(sectionId);
        if (!section) return;

        const checkboxes = section.querySelectorAll('.area-checkbox');
        const counterText = section.querySelector('.areas-selected');

        if (checkboxes.length && counterText) {
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function () {
                    const checkedBoxes = section.querySelectorAll('.area-checkbox:checked');
                    const checkedCount = checkedBoxes.length;

                    counterText.textContent = `${checkedCount} área${checkedCount !== 1 ? 's' : ''} selecionada${checkedCount !== 1 ? 's' : ''}`;

                    counterText.classList.toggle('max-reached', checkedCount >= maxSelecoes);

                    checkboxes.forEach(cb => {
                        if (checkedCount >= maxSelecoes) {
                            if (!cb.checked) {
                                cb.disabled = true;
                                cb.parentElement.classList.add('disabled');
                            }
                        } else {
                            cb.disabled = false;
                            cb.parentElement.classList.remove('disabled');
                        }
                    });
                });
            });
        }
    }

    /**
     * Mostra/esconde campos com base no tipo de vaga selecionado
     */
    function atualizarVisibilidadeCampos() {
        const tipo = tipoVagaSelect.value;
        camposComuns.style.display = tipo ? 'block' : 'none';
        camposAdmin.style.display = tipo === 'administrativo' ? 'block' : 'none';
        camposDocente.style.display = tipo === 'docente' ? 'block' : 'none';

        // Resetar seleções e estados anteriores
        document.querySelectorAll('#camposAdministrativo .areas-selected, #camposDocente .areas-selected').forEach(el => {
            el.textContent = '0 áreas selecionadas';
            el.classList.remove('max-reached');
        });
        document.querySelectorAll('.area-checkbox').forEach(cb => {
            cb.checked = false;
            cb.disabled = false;
            cb.parentElement.classList.remove('disabled');
        });
    }

    /**
     * Fecha o modal de sucesso
     */
    function fecharModal() {
        if (modalCandidatura) {
            modalCandidatura.classList.remove('show');
            document.body.style.overflow = 'auto';
        }
    }

    // --- Inicialização ---

    // Aplica máscara de telefone
    if (telefoneInputCandidatura) {
        aplicarMascaraTelefone(telefoneInputCandidatura);
    }

    // Aplica máscara de CPF
    const cpfInput = document.getElementById('cpf');
    if (cpfInput) {
        aplicarMascaraCPF(cpfInput);
    }

    // Configura a mudança de tipo de vaga
    if (tipoVagaSelect) {
        tipoVagaSelect.addEventListener('change', atualizarVisibilidadeCampos);
    }

    // Inicializa os limites de seleção para ambas as seções
    setupAreaSelection('camposAdministrativo', 5); // Limite de 5 áreas para admin
    setupAreaSelection('camposDocente', 5);       // Limite de 5 áreas para docente

    // --- Envio do Formulário ---

    if (formCandidatura) {
        formCandidatura.addEventListener('submit', function (e) {
            e.preventDefault();

            const submitButton = this.querySelector('.submit-button');
            const originalButtonText = submitButton.textContent;
            submitButton.disabled = true;
            submitButton.textContent = 'Enviando...';

            const tipoVaga = this.tipoVaga.value;
            if (!tipoVaga) {
                alert('Por favor, selecione o tipo de vaga.');
                submitButton.disabled = false;
                submitButton.textContent = originalButtonText;
                return;
            }

            const formData = new FormData(this);
            const formObject = {};

            // Processa campos de texto, email, tel, etc.
            for (const [key, value] of formData.entries()) {
                // Trata campos de checkbox (áreas de interesse) como arrays
                if (key === 'areaInteresseAdmin' || key === 'areaInteresseDocente') {
                    if (!formObject[key]) {
                        formObject[key] = [];
                    }
                    formObject[key].push(value);
                } else {
                    // Para outros campos, pega o último valor
                    formObject[key] = value;
                }
            }
            formObject.tipoVaga = tipoVaga;

            // Processa o arquivo
            const fileInput = this.querySelector(`input[type="file"][name="arquivo"]`);
            if (fileInput && fileInput.files[0]) {
                const file = fileInput.files[0];

                // Validação de tamanho (ex: 5MB)
                const maxSizeMB = 5;
                if (file.size > maxSizeMB * 1024 * 1024) {
                    alert(`O arquivo é muito grande. O tamanho máximo é ${maxSizeMB}MB.`);
                    submitButton.disabled = false;
                    submitButton.textContent = originalButtonText;
                    return;
                }

                // Validação de tipo
                const validTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
                if (!validTypes.includes(file.type)) {
                    alert('Tipo de arquivo inválido. Permitidos: PDF, DOC, DOCX.');
                    submitButton.disabled = false;
                    submitButton.textContent = originalButtonText;
                    return;
                }

                const reader = new FileReader();
                reader.onload = function (event) {
                    formObject.arquivo = {
                        name: file.name,
                        type: file.type,
                        data: event.target.result // Base64
                    };
                    enviarDados(formObject, submitButton, originalButtonText);
                };
                reader.onerror = function (error) {
                    console.error('Erro ao ler o arquivo:', error);
                    alert('Erro ao ler o arquivo. Tente novamente.');
                    submitButton.disabled = false;
                    submitButton.textContent = originalButtonText;
                };
                reader.readAsDataURL(file); // Lê como Data URL (Base64)
            } else {
                // Se não houver arquivo
                if (tipoVaga === 'docente') {
                    // O arquivo é obrigatório para docentes
                    alert('O upload do currículo é obrigatório para vagas docentes.');
                    submitButton.disabled = false;
                    submitButton.textContent = originalButtonText;
                    return;
                }
                // Para administrativo, envia sem arquivo
                enviarDados(formObject, submitButton, originalButtonText);
            }
        });
    }

    /**
     * Envia os dados coletados para o Google Apps Script
     * @param {Object} dataToSend - Objeto contendo os dados do formulário
     * @param {HTMLButtonElement} button - Botão de submit
     * @param {string} originalText - Texto original do botão
     */
    function enviarDados(dataToSend, button, originalText) {
        fetch(SCRIPT_URL_CANDIDATURA, {
            method: 'POST',
            mode: 'no-cors', // Crucial para evitar CORS de sites externos
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json',
            },
            redirect: 'follow',
            body: JSON.stringify(dataToSend)
        })
        .then(response => {
            // Com mode: 'no-cors', não conseguimos ler a resposta real.
            // Mas se chegou aqui sem erro de rede, assumimos sucesso.
            console.log('Formulário de candidatura enviado com sucesso (ou requisição feita).');
            formCandidatura.reset();
            atualizarVisibilidadeCampos(); // Reseta visibilidade dos campos

            button.disabled = false;
            button.textContent = originalText;

            // Mostra modal de sucesso
            if (modalCandidatura) {
                modalCandidatura.classList.add('show');
                document.body.style.overflow = 'hidden';
            }
        })
        .catch(error => {
            console.error('Erro ao enviar formulário de candidatura:', error);
            alert("Ocorreu um erro ao enviar o formulário. Por favor, tente novamente.");
            button.disabled = false;
            button.textContent = originalText;
        });
    }

    // --- Modal de Sucesso ---

    if (modalCandidatura) {
        const closeBtn = modalCandidatura.querySelector('.close-modal');
        if (closeBtn) {
            closeBtn.addEventListener('click', fecharModal);
        }
        window.addEventListener('click', function (event) {
            if (event.target === modalCandidatura) {
                fecharModal();
            }
        });
    }

});
</script>
</body>
</html>